#!/bin/bash

set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

export GIT_PYTHON_REFRESH=quiet

cd /var/vcap/packages/godojo/bin/django-DefectDojo

#use godojo env
source /var/vcap/packages/godojo/bin/bin/activate

export PATH=/var/vcap/packages/godojo/bin/bin:${PATH}

#start celery workers
C_FORCE_ROOT="true" celery -A dojo worker -l info --concurrency 3 &

# Startup the Celery beat process
C_FORCE_ROOT="true" celery --app dojo beat -l info &

# Startup DefectDojo on port 8081
uwsgi --http :8001 --module dojo.wsgi
