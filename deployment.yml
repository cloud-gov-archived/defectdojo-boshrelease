---
name: defectdojo
stemcells:
- alias: default
  os: ubuntu-jammy
  version: latest
releases:
  - name: defectdojo
    version: latest
  - name: bpm
    version: latest
  - name: routing
    version: latest
  - name: bosh-dns-aliases
    version: latest

update:
  canaries: 2
  max_in_flight: 1
  canary_watch_time: 5000-60000
  update_watch_time: 5000-60000
instance_groups:
- name: defectdojo
  azs: [z1, z2]
  instances: 1
  jobs:
    - name: route_registrar
      consumes:
        nats-tls:
          deployment: cf-development
          from: nats-tls
      properties:
        nats:
          tls:
            client_cert: ((/bosh/cf-development/nats_client_cert.certificate))
            client_key: ((/bosh/cf-development/nats_client_cert.private_key))
            enabled: true
        route_registrar:
          routes:
          - name: dojo-dashboard
            port: 8080
            registration_interval: 2s
            timeout: 1s
            uris:
            - dojo-beta.dev.us-gov-west-1.aws-us-gov.cloud.gov
      release: routing
    - name: bosh-dns-aliases
      properties:
        aliases:
        - domain: nats.service.cf.internal
          targets:
          - deployment: cf-development
            domain: bosh
            instance_group: nats
            network: default
            query: '*'
      release: bosh-dns-aliases
    - name: bpm
      release: bpm
    - name: defectdojo
      properties:
        dojo:
          DD_DATABASE_HOST: ((dojo_database_host))
          DD_DATABASE_USER: ((dojo_database_user))
          DD_DATABASE_PASSWORD: ((dojo_database_password))
      release: defectdojo
  vm_type: t3.medium
  stemcell: default
  persistent_disk: 10240
  networks:
  - name: default
