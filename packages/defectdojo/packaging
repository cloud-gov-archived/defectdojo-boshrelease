#!/bin/bash
set -eo pipefail

# blob source: https://github.com/DefectDojo/django-DefectDojo/archive/refs/tags/2.25.4.tar.gz
mkdir -p source
tar -xzf defectdojo/2.25.4.tar.gz -C source # result: source/django-DefectDojo-2.25.4
ls source | xargs -I% cp -r source/%/. $BOSH_INSTALL_TARGET
cd $BOSH_INSTALL_TARGET

export PATH="/var/vcap/packages/python3/bin:${PATH}" LD_LIBRARY_PATH="/var/vcap/packages/python3/lib:${LD_LIBRARY_PATH}" C_INCLUDE_PATH="/var/vcap/packages/python3/include:${C_INCLUDE_PATH}"

pip3 install -r requirements.txt "--prefix=${BOSH_INSTALL_TARGET}"
