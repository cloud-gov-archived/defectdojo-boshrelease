#!/bin/bash
set -eo pipefail

# blob source: https://github.com/DefectDojo/django-DefectDojo/archive/refs/tags/2.25.4.tar.gz
mkdir -p source
tar -xzf defectdojo/2.25.4.tar.gz -C source # result: source/django-DefectDojo-2.25.4
ls source | xargs -I% cp -r source/%/. $BOSH_INSTALL_TARGET
cd $BOSH_INSTALL_TARGET

python3 --version
apt-get -y update
apt-get -y install --no-install-recommends python3-pip \
  gcc \
  build-essential \
  dnsutils \
  default-mysql-client \
  libmariadb-dev-compat \
  libpq-dev \
  postgresql-client \
  xmlsec1 \
  git \
  uuid-runtime \
  libcurl4-openssl-dev

pip3 --version
pip3 install -r requirements.txt "--prefix=${BOSH_INSTALL_TARGET}"
